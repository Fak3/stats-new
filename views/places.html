{% extends 'page.html' %}

{% set fragment = 'place' %}

{% block heading %}{% endblock heading %}

{% block breadcrumbs_inner %}
    <li class="active">Places</li>
{% endblock breadcrumbs_inner %}

{% block content %}
<header id="place-intro" class="page-header">
  <h1>Place overview {% if page.year != scope.cgr.current_year %}{{ page.year }}{% endif %}</h1>
  <hr />
  {{ page.content }}
</header>

<div class="row">
  <div class="col-md-12">
    <h4>Search</h4>
    <form role="form" class="form-inline data-table-tools">
      <div class="form-group">
        <input class="form-control filter-table" type="search" name="filter-table" placeholder="Search for a place" />
      </div>
    </form>
  </div>
</div>

<div class="table-responsive">
  <table id="places_overview_table" class="table data-table table-header-stuck">
    <thead>
      <tr>
        <th class="sort_place" title="Sort by A-Z">Place</th>
        {% for risk in scope.risks %}
          {% if risk.id %}
            <th>
              {{ risk.title }}
            </th>
          {% endif %}
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for place in scope.places %}
        {% if place.id %}
          <tr data-rank="{{ place[scope.rank_lookup] or scope.cgr.na }}" data-score="{{ place[scope.score_lookup] or scope.cgr.na }}" data-place="{{ place.slug }}">
            <td>  
              <a href="{{ SITEURL }}/place/{{ place.slug }}/" title="{{ place.name }}">
                {{ place.name|truncate(28) }}
              </a>
            </td>
            {% for risk in scope.risks %}
              {% if risk.id %}
                {% set entry = scope.entries|search({place: place.id, risk:risk.id}) %}
                <td class="score" data-score="{{ entry['score'] or scope.cgr.na }}">
                   <span>{{ entry.score or "N/A"}}</span>
                </td>
              {% endif %}
            {% endfor %}
          </tr>
        {% endif %}  
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock content %}
